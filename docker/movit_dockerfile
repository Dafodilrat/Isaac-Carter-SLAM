FROM moveit/moveit2:humble-source

ENV DEBIAN_FRONTEND=noninteractive
ENV DOCKER_USER_HOME=/root

RUN apt update && apt install -y python3-pip ros-humble-rviz2 && pip install --upgrade pip

COPY docker/movit_entrypoint.sh /movit_entrypoint.sh

RUN chmod +x /movit_entrypoint.sh

RUN wget http://snapshots.ros.org/humble/2025-06-18/ubuntu/pool/main/r/ros-humble-rviz-common/ros-humble-rviz-common_11.2.17-1jammy.20250617.234657_amd64.deb
RUN dpkg -i ros-humble-rviz-common_11.2.17-1jammy.20250617.234657_amd64.deb

RUN echo "source /opt/ros/humble/setup.bash" >> /root/.bashrc && \
    echo "source /slam_ws/install/setup.bash" >> /root/.bashrc && \
    echo "/root/ws_moveit/install/setup.bash" >> /root/.bashrc && \
    echo "export ROS_DISTRO=humble" >> /root/.bashrc && \
    echo "export RMW_IMPLEMENTATION=rmw_fastrtps_cpp" >> /root/.bashrc

WORKDIR /slam_ws
